sudo mn --topo linear,3,2 --mac --switch ovsk --controller remote -x

xterm c0

#s1
ovs-vsctl set Bridge s1 protocols=OpenFlow13

#s2
ovs-vsctl set Bridge s2 protocols=OpenFlow13

#s3
ovs-vsctl set Bridge s3 protocols=OpenFlow13

#host: h1s1:
ip addr del 10.0.0.1/8 dev h1s1-eth0
ip link add link h1s1-eth0 name h1s1-eth0.2 type vlan id 2
ip addr add 172.16.10.10/24 dev h1s1-eth0.2
ip link set dev h1s1-eth0.2 up

#host: h2s1
ip addr del 10.0.0.4/8 dev h2s1-eth0
ip link add link h2s1-eth0 name h2s1-eth0.110 type vlan id 110
ip addr add 172.16.10.11/24 dev h2s1-eth0.110
ip link set dev h2s1-eth0.110 up

#host: h1s2
ip addr del 10.0.0.2/8 dev h1s2-eth0
ip link add link h1s2-eth0 name h1s2-eth0.2 type vlan id 2
ip addr add 192.168.30.10/24 dev h1s2-eth0.2
ip link set dev h1s2-eth0.2 up

#host: h2s2:
ip addr del 10.0.0.5/8 dev h2s2-eth0
ip link add link h2s2-eth0 name h2s2-eth0.110 type vlan id 110
ip addr add 192.168.30.11/24 dev h2s2-eth0.110
ip link set dev h2s2-eth0.110 up

#host: h1s3:
ip addr del 10.0.0.3/8 dev h1s3-eth0
ip link add link h1s3-eth0 name h1s3-eth0.2 type vlan id 2
ip addr add 172.16.20.10/24 dev h1s3-eth0.2
ip link set dev h1s3-eth0.2 up

#host: h2s3:
ip addr del 10.0.0.6/8 dev h2s3-eth0
ip link add link h2s3-eth0 name h2s3-eth0.110 type vlan id 110
ip addr add 172.16.20.11/24 dev h2s3-eth0.110
ip link set dev h2s3-eth0.110 up

#ryu-manager ryu.app.rest_router

Node: c0 (root): s1
# curl -X POST -d '{"address": "172.16.10.1/24"}' http://localhost:8080/router/0000000000000001/2

# curl -X POST -d '{"address": "10.10.10.1/24"}' http://localhost:8080/router/0000000000000001/2

# curl -X POST -d '{"address": "172.16.10.1/24"}' http://localhost:8080/router/0000000000000001/110

# curl -X POST -d '{"address": "10.10.10.1/24"}' http://localhost:8080/router/0000000000000001/110

Node: c0 (root): s2
# curl -X POST -d '{"address": "192.168.30.1/24"}' http://localhost:8080/router/0000000000000002/2

# curl -X POST -d '{"address": "10.10.10.2/24"}' http://localhost:8080/router/0000000000000002/2

# curl -X POST -d '{"address": "192.168.30.1/24"}' http://localhost:8080/router/0000000000000002/110

# curl -X POST -d '{"address": "10.10.10.2/24"}' http://localhost:8080/router/0000000000000002/110

Node: c0 (root): s3
# curl -X POST -d '{"address": "172.16.20.1/24"}' http://localhost:8080/router/0000000000000003/2

# curl -X POST -d '{"address": "10.10.10.3/24"}' http://localhost:8080/router/0000000000000003/2

# curl -X POST -d '{"address": "172.16.20.1/24"}' http://localhost:8080/router/0000000000000003/110

# curl -X POST -d '{"address": "10.10.10.3/24"}' http://localhost:8080/router/0000000000000003/110

host: h1s1:
# ip route add default via 172.16.10.1
host: h2s1:
# ip route add default via 172.16.10.1
host: h1s2:
# ip route add default via 192.168.30.1
host: h2s2:
# ip route add default via 192.168.30.1
host: h1s3:
# ip route add default via 172.16.20.1
host: h2s3:
# ip route add default via 172.16.20.1

First, set router s2 as the default route of router s1.
Node: c0 (root):
# curl -X POST -d '{"gateway": "10.10.10.2"}' http://localhost:8080/router/0000000000000001/2

# curl -X POST -d '{"gateway": "10.10.10.2"}' http://localhost:8080/router/0000000000000001/110

Set router s1 as the default route of router s2.
Node: c0 (root):
# curl -X POST -d '{"gateway": "10.10.10.1"}' http://localhost:8080/router/0000000000000002/2

# curl -X POST -d '{"gateway": "10.10.10.1"}' http://localhost:8080/router/0000000000000002/110

Set router s2 as default route of router s3.
Node: c0 (root):
# curl -X POST -d '{"gateway": "10.10.10.2"}' http://localhost:8080/router/0000000000000003/2

# curl -X POST -d '{"gateway": "10.10.10.2"}' http://localhost:8080/router/0000000000000003/110

Next, for s2 router, set a static route to the host (172.16.20.0/24) under router s3. Only set if vlan_id=2.
Node: c0 (root):
# curl -X POST -d '{"destination": "172.16.20.0/24", "gateway": "10.10.10.3"}' http://localhost:8080/router/0000000000000002/2


